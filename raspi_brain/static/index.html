<html>

<head>
  <style>
    body,
    #container {
      width: 100%;
      padding: 0px;
      margin: 0px;
    }
  </style>
</head>

<body>
  <div id="container">
  </div>

  <script src="./jquery-3.4.1.min.js"></script>
  <script src="./p5.min.js"></script>
  <script src="./p5.dom.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    let driveButton, driveTillHitButton, letterButton;
    function setup() {
      createCanvas(800, 400);
      driveButton = createButton('drive');
      driveButton.mousePressed(() => {
        socket.emit('client', { command: 'drive', steps: 1000 })
      });
      driveTillHitButton = createButton('drive till hit');
      driveTillHitButton.mousePressed(() => {
        socket.emit('client', { command: 'driveTillHit' })
      });
      letterButton = createButton('letter');
      letterButton.mousePressed(() => {
        socket.emit('client', { command: 'letter', index: parseInt(Math.random() * 4) })
      });
    }

    const bumper = { status: '' };
    const position = { x: 0, y: 0 };
    const positionTarget = { x: 0, y: 0 };
    function draw() {
      let bg;
      if (bumper.status == 'hit') {
        bg = [255, 0, 0];
      }
      else if (bumper.status == 'released') {
        bg = [0, 255, 0];
      }
      else
        bg = [0, 0, 0];
      background(bg[0], bg[1], bg[2]);
      fill(255);
      position.x = lerp(position.x, positionTarget.x, 0.5);
      position.y = lerp(position.y, positionTarget.y, 0.5);
      ellipse(position.y * 0.1, position.x * 0.1, 20, 20);
    }
    socket.on('bumper', (msg) => {
      console.log(msg)
      bumper.status = msg.status;
    });
    // socket.on('position', (msg) => {
    //   console.log(msg)
    // });
    socket.on('world', (msg) => {
      console.log(msg)
      positionTarget.x = msg.x;
      positionTarget.y = msg.y;
    });
    socket.on('servo', (msg) => {
      console.log(msg)
    });
  </script>
</body>

</html>